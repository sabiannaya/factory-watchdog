import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-CA8oNPt4.js";import{d as tt}from"./index-C4J_hXM0.js";import{d as H,c as e,a as t,b as B,t as d,n as F,o as a,e as p,r as L,w as et,f as at,g as st,F as T,h as D,i as K,j as ot,k as P,u as g,l as lt,m as nt}from"./app-ByVm3FOg.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C8rHliBE.js";import"./index-CbbRSED3.js";import"./VisuallyHidden-CuZB7xnA.js";import"./useForwardExpose-B_jyS2_j.js";import"./useForwardPropsEmits-DpcW7WWk.js";import"./createLucideIcon-B5wOFtcm.js";const rt={class:"rounded-xl border border-sidebar-border/70 p-6 bg-card"},it={class:"flex items-center justify-between"},ut={class:"flex-1"},ct={class:"text-sm font-medium text-muted-foreground"},dt={class:"text-3xl font-bold mt-2"},ht={key:0,class:"text-xs text-muted-foreground mt-1"},mt={key:0,class:"text-right"},A=H({__name:"StatCard",props:{title:{},value:{},subtitle:{},trend:{},trendValue:{}},setup(o){return(k,s)=>(a(),e("div",rt,[t("div",it,[t("div",ut,[t("p",ct,d(o.title),1),t("h3",dt,d(o.value),1),o.subtitle?(a(),e("p",ht,d(o.subtitle),1)):B("",!0)]),o.trend&&o.trendValue?(a(),e("div",mt,[t("span",{class:F([{"text-green-600":o.trend==="up","text-red-600":o.trend==="down","text-gray-600":o.trend==="neutral"},"text-sm font-medium"])},d(o.trend==="up"?"↑":o.trend==="down"?"↓":"→")+" "+d(o.trendValue),3)])):B("",!0)])]))}}),vt={class:"rounded-xl border border-sidebar-border/70 p-6 bg-card"},xt={key:0,class:"text-lg font-semibold mb-4"},pt={key:1,class:"text-center text-muted-foreground py-8"},ft=["viewBox"],_t=["x1","y1","x2","y2"],gt=["x","y"],bt=["d"],yt=["d"],$t=["cx","cy","onMouseenter"],kt=["cx","cy","onMouseenter"],Mt=["x","y"],wt=["aria-hidden"],Nt={class:"font-semibold"},j=300,G=800,Tt=H({__name:"LineChart",props:{data:{},title:{}},setup(o){const k=o,s=p(()=>k.data??[]),u=L(null),M=p(()=>{const l=s.value.flatMap(r=>[Number(r.target??0),Number(r.actual??0)]);return Math.max(...l,100)}),f=p(()=>{const l=M.value;if(l<=0)return 100;const r=Math.pow(10,Math.floor(Math.log10(l))),n=l/r;let i=Math.ceil(n);return i<=2?i=2:i<=5&&(i=5),i*r}),m={top:20,right:20,bottom:40,left:50},c=l=>m.left+l*(G-m.left-m.right)/Math.max(s.value.length-1,1),v=l=>j-m.bottom-l/f.value*(j-m.top-m.bottom),w=p(()=>s.value.length===0?"":`M ${s.value.map((r,n)=>`${c(n)},${v(Number(r.target??0))}`).join(" L ")}`),y=p(()=>s.value.length===0?"":`M ${s.value.map((r,n)=>`${c(n)},${v(Number(r.actual??0))}`).join(" L ")}`),x=p(()=>{const r=[];for(let n=1;n<=5;n++){const i=f.value*n/5;r.push({y:v(i),label:Math.round(i)})}return r}),_=p(()=>s.value.map((l,r)=>({x:c(r),y:v(Number(l.target??0))}))),h=p(()=>s.value.map((l,r)=>({x:c(r),y:v(Number(l.actual??0))}))),b=p(()=>{if(!u.value)return null;const{index:l}=u.value,r=u.value.series==="target"?_.value[l]:h.value[l],n=s.value[l];return!r||!n?null:{x:r.x,y:r.y,date:n.date,target:n.target,actual:n.actual,series:u.value.series}}),V=L(null),I=L(null),z=L(null),$=L(null);et(b,async l=>{if(!l){$.value=null;return}await at();const r=V.value,n=I.value,i=z.value;if(!r||!n||!i){$.value=null;return}const C=r.getBoundingClientRect(),N=n.getBoundingClientRect(),X=l.x/G*N.width,Y=l.y/j*N.height;let E=N.left-C.left+X,R=N.top-C.top+Y;R=R-i.offsetHeight-8;const O=8,Z=N.left-C.left+O,q=N.left-C.left+N.width-i.offsetWidth-O;E=Math.max(Z,Math.min(q,E));const J=N.top-C.top+O,Q=N.top-C.top+N.height-i.offsetHeight-O;R=Math.max(J,Math.min(Q,R)),$.value={left:Math.round(E),top:Math.round(R)}},{immediate:!0});const S=(l,r)=>{u.value={series:l,index:r}},W=()=>{u.value=null};return(l,r)=>(a(),e("div",vt,[o.title?(a(),e("h3",xt,d(o.title),1)):B("",!0),s.value.length===0?(a(),e("div",pt," No data available ")):(a(),e("div",{key:2,class:"relative w-full",ref_key:"containerRef",ref:V},[(a(),e("svg",{ref_key:"svgRef",ref:I,viewBox:`0 0 ${G} ${j}`,width:"100%",height:j},[(a(!0),e(T,null,D(x.value,(n,i)=>(a(),e("line",{key:`grid-${i}`,x1:m.left,y1:n.y,x2:G-m.right,y2:n.y,stroke:"#e5e7eb","stroke-width":"1"},null,8,_t))),128)),(a(!0),e(T,null,D(x.value,(n,i)=>(a(),e("text",{key:`ylabel-${i}`,x:m.left-10,y:n.y+4,"text-anchor":"end",class:"text-xs fill-muted-foreground"},d(n.label),9,gt))),128)),t("path",{d:w.value,fill:"none",stroke:"#3b82f6","stroke-width":"2"},null,8,bt),t("path",{d:y.value,fill:"none",stroke:"#10b981","stroke-width":"2"},null,8,yt),(a(!0),e(T,null,D(s.value,(n,i)=>(a(),e("circle",{key:`target-${i}`,cx:c(i),cy:v(Number(n.target??0)),r:"4",fill:"#3b82f6",onMouseenter:C=>S("target",i),onMouseleave:W},null,40,$t))),128)),(a(!0),e(T,null,D(s.value,(n,i)=>(a(),e("circle",{key:`actual-${i}`,cx:c(i),cy:v(Number(n.actual??0)),r:"4",fill:"#10b981",onMouseenter:C=>S("actual",i),onMouseleave:W},null,40,kt))),128)),(a(!0),e(T,null,D(s.value,(n,i)=>(a(),e("text",{key:`xlabel-${i}`,x:c(i),y:j-m.bottom+20,"text-anchor":"middle",class:"text-xs fill-muted-foreground"},d(n.date),9,Mt))),128))],8,ft)),t("div",{ref_key:"tooltipRef",ref:z,class:F(["absolute rounded-md border border-border bg-card text-card-foreground px-3 py-2 shadow-lg text-xs pointer-events-none transition-opacity duration-200 z-50",{"opacity-0":!$.value,"opacity-100":$.value}]),style:K({left:$.value?`${$.value.left}px`:"-9999px",top:$.value?`${$.value.top}px`:"-9999px"}),"aria-hidden":!$.value},[t("div",Nt,d(b.value?b.value.date:""),1),t("div",null,"Target: "+d(b.value?b.value.target:""),1),t("div",null,"Actual: "+d(b.value?b.value.actual:""),1)],14,wt)],512)),r[0]||(r[0]=st('<div class="flex items-center justify-center gap-6 mt-4"><div class="flex items-center gap-2"><div class="w-4 h-4 bg-blue-500 rounded-full"></div><span class="text-sm text-muted-foreground">Target</span></div><div class="flex items-center gap-2"><div class="w-4 h-4 bg-green-500 rounded-full"></div><span class="text-sm text-muted-foreground">Actual</span></div></div>',1))]))}}),Pt={class:"rounded-xl border border-sidebar-border/70 p-6 bg-card w-full"},Dt={key:0,class:"text-lg font-semibold"},Ct={key:1,class:"text-sm text-muted-foreground"},Lt={key:2,class:"flex flex-col items-center justify-center h-full"},Vt={class:"flex justify-center w-full mb-6"},jt={width:"200",height:"200",viewBox:"0 0 160 160",class:"flex-shrink-0 block"},Rt=["d","fill"],Bt={class:"w-full"},Ht={class:"text-sm space-y-2"},It={class:"flex items-center gap-2 min-w-0"},zt={class:"truncate"},St={class:"text-muted-foreground flex-shrink-0"},Wt={class:"text-xs text-muted-foreground mt-3 pt-3 border-t"},Ot=H({__name:"PieChart",props:{data:{},title:{},colors:{}},setup(o){const k=o,s=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"],u=p(()=>k.colors??s),M=p(()=>(k.data??[]).map(c=>({label:c.label,value:Number(c.value??0)}))),f=p(()=>M.value.reduce((c,v)=>c+v.value,0)),m=p(()=>{let c=0;return M.value.map((v,w)=>{const y=Number(v.value||0),x=f.value===0?0:y/f.value*Math.PI*2,_=c+x,h=60,b=80,V=80,I=b+h*Math.cos(c-Math.PI/2),z=V+h*Math.sin(c-Math.PI/2),$=b+h*Math.cos(_-Math.PI/2),S=V+h*Math.sin(_-Math.PI/2),W=x>Math.PI?1:0,l=`M ${b} ${V} L ${I} ${z} A ${h} ${h} 0 ${W} 1 ${$} ${S} Z`;return c=_,{path:l,label:v.label,value:y}})});return(c,v)=>(a(),e("div",Pt,[o.title?(a(),e("h3",Dt,d(o.title),1)):B("",!0),M.value.length===0?(a(),e("div",Ct,"No data")):(a(),e("div",Lt,[t("div",Vt,[(a(),e("svg",jt,[t("g",null,[v[0]||(v[0]=t("circle",{cx:"80",cy:"80",r:"60",fill:"var(--card)"},null,-1)),t("g",null,[(a(!0),e(T,null,D(m.value,(w,y)=>(a(),e("path",{key:y,d:w.path,fill:u.value[y%u.value.length]},null,8,Rt))),128))])])]))]),t("div",Bt,[t("ul",Ht,[(a(!0),e(T,null,D(m.value,(w,y)=>(a(),e("li",{key:y,class:"flex items-center justify-between gap-3"},[t("div",It,[t("span",{class:"w-2.5 h-2.5 rounded-sm flex-shrink-0",style:K({background:u.value[y%u.value.length]})},null,4),t("span",zt,d(w.label),1)]),t("div",St,d(w.value),1)]))),128))]),t("div",Wt,"Total: "+d(f.value),1)])]))]))}}),At={class:"rounded-xl border border-sidebar-border/70 p-6 bg-card"},Gt={key:0,class:"text-lg font-semibold mb-6"},Et={key:1,class:"text-sm text-muted-foreground py-24 text-center"},Ft={key:2,class:"chart-wrapper"},Kt={class:"bar-container"},Xt={class:"mt-4 flex flex-col items-center gap-1"},Yt={class:"text-sm font-semibold text-foreground text-center"},Zt={class:"text-lg font-bold text-blue-600"},qt=H({__name:"BarChart",props:{data:{},title:{},labelKey:{},valueKey:{}},setup(o){const k=o,s=p(()=>(k.data??[]).map(f=>({label:f.label,value:Number(f.value??0)}))),u=p(()=>{const f=s.value.map(m=>m.value);return Math.max(...f,1)}),M=p(()=>s.value.map(f=>{const w=20+(u.value===0?0:f.value/u.value)*80;return Math.round(w)}));return(f,m)=>(a(),e("div",At,[o.title?(a(),e("h3",Gt,d(o.title),1)):B("",!0),s.value.length===0?(a(),e("div",Et," No data ")):(a(),e("div",Ft,[(a(!0),e(T,null,D(s.value,(c,v)=>(a(),e("div",{key:v,class:"bar-item"},[t("div",Kt,[t("div",{style:K({height:`${M.value[v]}%`}),class:"bar"},null,4)]),t("div",Xt,[t("div",Yt,d(c.label),1),t("div",Zt,d(c.value),1)])]))),128))]))]))}}),Jt=(o,k)=>{const s=o.__vccOpts||o;for(const[u,M]of k)s[u]=M;return s},Qt=Jt(qt,[["__scopeId","data-v-55e30bdd"]]),Ut={class:"flex h-full flex-1 flex-col gap-4 p-4"},te={class:"grid gap-4 md:grid-cols-4"},ee={class:"grid md:grid-cols-3 gap-4"},ae={class:"md:col-span-2"},se={class:"md:col-span-1 flex justify-center"},oe={class:"mt-2"},le={class:"rounded-xl border border-sidebar-border/70 p-6 bg-card"},ne={key:0,class:"text-center text-muted-foreground py-8"},re={key:1,class:"overflow-x-auto"},ie={class:"min-w-full divide-y divide-sidebar-border/70"},ue={class:"divide-y divide-sidebar-border/70"},ce={class:"px-4 py-2 text-sm"},de={class:"px-4 py-2 text-sm"},he={class:"px-4 py-2 text-sm"},me={class:"px-4 py-2 text-sm text-muted-foreground"},ve={class:"px-4 py-2 text-sm text-right"},xe={class:"px-4 py-2 text-sm text-right"},we=H({__name:"Dashboard",props:{stats:{},dailyTrends:{},recentLogs:{},groupDistribution:{},productionWeekly:{}},setup(o){const k=[{title:"Dashboard",href:tt().url}],s=o,u=s.stats??{total_productions:0,active_productions:0,total_machine_groups:0,today_performance:0,today_actual:0,today_target:0},M=s.dailyTrends??[],f=s.recentLogs??[],m=L(s.groupDistribution??[]),c=L(s.productionWeekly??[]);ot(async()=>{if(!m.value?.length||!c.value?.length)try{const x=await fetch("/api/dashboard/aggregates");if(x.ok){const _=await x.json();m.value?.length||(m.value=_.groupDistribution??[]),c.value?.length||(c.value=_.productionWeekly??[])}}catch(x){return x}});const v=p(()=>(m.value||[]).map(x=>({label:x.machine_group,value:x.total_output}))),w=p(()=>(c.value||[]).map(x=>({label:x.production,value:x.total_output})));function y(x){if(!x)return"";const _=new Date(x);return Number.isNaN(_.getTime())?x:_.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}return(x,_)=>(a(),e(T,null,[P(g(lt),{title:"Dashboard"}),P(U,{breadcrumbs:k},{default:nt(()=>[t("div",Ut,[t("div",te,[P(A,{title:"Total Productions",value:g(u).total_productions,subtitle:`${g(u).active_productions} active`},null,8,["value","subtitle"]),P(A,{title:"Machine Groups",value:g(u).total_machine_groups},null,8,["value"]),P(A,{title:"Today's Performance",value:`${g(u).today_performance}%`,trend:g(u).today_performance>=100?"up":g(u).today_performance>=90?"neutral":"down","trend-value":`${g(u).today_actual} / ${g(u).today_target}`},null,8,["value","trend","trend-value"]),P(A,{title:"Today's Output",value:g(u).today_actual,subtitle:`Target: ${g(u).today_target}`},null,8,["value","subtitle"])]),t("div",ee,[t("div",ae,[P(Tt,{data:g(M),title:"7-Day Production Trend"},null,8,["data"])]),t("div",se,[P(Ot,{data:v.value,title:"Group Output Distribution (24h)"},null,8,["data"])])]),t("div",oe,[P(Qt,{data:w.value,title:"Production Output (7d)"},null,8,["data"])]),t("div",le,[_[1]||(_[1]=t("h3",{class:"text-lg font-semibold mb-4"},"Recent Hourly Logs",-1)),g(f).length===0?(a(),e("div",ne," No recent logs available ")):(a(),e("div",re,[t("table",ie,[_[0]||(_[0]=t("thead",null,[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-sm font-medium"},"Production"),t("th",{class:"px-4 py-2 text-left text-sm font-medium"},"Machine Group"),t("th",{class:"px-4 py-2 text-left text-sm font-medium"},"Machine #"),t("th",{class:"px-4 py-2 text-left text-sm font-medium"},"Time"),t("th",{class:"px-4 py-2 text-right text-sm font-medium"},"Output"),t("th",{class:"px-4 py-2 text-right text-sm font-medium"},"Target"),t("th",{class:"px-4 py-2 text-right text-sm font-medium"},"Variance")])],-1)),t("tbody",ue,[(a(!0),e(T,null,D(g(f),(h,b)=>(a(),e("tr",{key:b,class:"hover:bg-sidebar-border/5"},[t("td",ce,d(h.production),1),t("td",de,d(h.machine_group),1),t("td",he,d(h.machine_index),1),t("td",me,d(y(h.recorded_at)),1),t("td",ve,d(h.output),1),t("td",xe,d(h.target),1),t("td",{class:F(["px-4 py-2 text-sm text-right font-medium",{"text-green-600":h.output>=h.target,"text-red-600":h.output<h.target}])},d(h.output-h.target>=0?"+":"")+d(h.output-h.target),3)]))),128))])])]))])])]),_:1})],64))}});export{we as default};
