import{d as O,r as f,e as x,K as B,w as E,c as r,k as U,u as o,l as L,m as H,a as t,b as p,o as n,t as u,q as a,s as Q,E as $,H as i,I as c,F as k,h as q,L as S,J as N}from"./app-ue20rSb4.js";import{_ as z}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_szTgFs.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C7b_Quob.js";import"./index-Cl--hQqE.js";import"./VisuallyHidden-DjuZqZTT.js";import"./useForwardExpose-BCEiolqJ.js";import"./useForwardPropsEmits-BgPdB8_u.js";import"./index-C4J_hXM0.js";import"./createLucideIcon-COama0qN.js";const K={class:"p-4 space-y-6"},J={key:0,class:"rounded-lg bg-destructive/10 border border-destructive/30 p-4"},X={class:"text-destructive font-medium"},W={key:1,class:"rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-300 dark:border-amber-700 p-4"},Y={class:"flex items-start gap-3"},Z={class:"text-sm text-amber-700 dark:text-amber-300 mt-1"},ee={class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},le=["value"],se=["value"],oe=["disabled"],re=["value"],ne={key:0,class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},ue={class:"text-sm text-muted-foreground mb-4"},de={key:0,class:"space-y-4"},ae={key:0,class:"text-red-500 text-sm mt-1"},ie={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={key:0,class:"text-red-500 text-sm mt-1"},pe={key:0,class:"text-red-500 text-sm mt-1"},ce={key:2,class:"space-y-4"},ve={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},be={class:"block text-sm font-medium mb-2"},ye=["onUpdate:modelValue"],ge={key:3,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},fe=["value"],xe={class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4"},ke={key:0},_e={class:"flex items-center gap-3"},we=["disabled"],Ee=O({__name:"Create",props:{productions:{},selectedProductionId:{},selectedDate:{},selectedHour:{}},setup(P){const T=[{title:"Input",href:"/input"},{title:"Record Input",href:window.location.pathname}],v=P,_=f(v.selectedProductionId),w=f(v.selectedDate),h=f(parseInt(v.selectedHour)||new Date().getHours()),b=f(null),G=x(()=>v.productions.find(d=>d.production_id===_.value)),D=x(()=>G.value?.machine_groups??[]),V=x(()=>D.value.find(d=>d.production_machine_group_id===b.value)),m=x(()=>V.value?.input_config),M=x(()=>V.value?.fields??[]),s=B({production_machine_group_id:null,date:v.selectedDate,hour:parseInt(v.selectedHour)||new Date().getHours(),qty:null,qty_normal:null,qty_reject:null,grades:{},grade:null,ukuran:null,keterangan:null}),y=f(null),I=f(!1);let g;const j=async()=>{if(!b.value||!w.value){y.value=null;return}I.value=!0;try{const e=await(await fetch("/input/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({production_machine_group_id:b.value,date:w.value,hour:h.value})})).json();y.value=e.exists?e.entry:null}catch(d){console.error("Error checking duplicate:",d)}finally{I.value=!1}};E(b,d=>{s.production_machine_group_id=d,s.qty=null,s.qty_normal=null,s.qty_reject=null,s.grades={},s.grade=null,s.ukuran=null,m.value?.type==="grades"&&m.value.grade_types&&m.value.grade_types.forEach(e=>{s.grades[e]=null}),g&&clearTimeout(g),g=setTimeout(j,300)}),E([w,h],([d,e])=>{s.date=d,s.hour=e,g&&clearTimeout(g),g=setTimeout(j,300)});const F=Array.from({length:24},(d,e)=>({value:e,label:`${e.toString().padStart(2,"0")}:00`})),R=()=>{y.value&&!window.confirm("A record already exists for this selection. Are you sure you want to create another entry?")||s.post("/input",{onSuccess:()=>{N.get("/input",{date:s.date,production_id:_.value})}})},C=x(()=>!!s.errors.duplicate);return(d,e)=>(n(),r(k,null,[U(o(L),{title:"Record Hourly Input"}),U(z,{breadcrumbs:T},{default:H(()=>[t("div",K,[e[33]||(e[33]=t("div",null,[t("h1",{class:"text-2xl font-bold"},"Record Hourly Input"),t("p",{class:"text-muted-foreground"},"Record production output for a specific hour")],-1)),C.value?(n(),r("div",J,[t("p",X,u(o(s).errors.duplicate),1)])):p("",!0),y.value&&!C.value?(n(),r("div",W,[t("div",Y,[e[15]||(e[15]=t("svg",{class:"size-5 text-amber-600 dark:text-amber-400 mt-0.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("div",null,[e[14]||(e[14]=t("p",{class:"font-medium text-amber-800 dark:text-amber-200"},"Existing Entry Found",-1)),t("p",Z,[a(" A record already exists for this machine group at "+u(y.value.recorded_at)+". ",1),U(o(Q),{href:`/input/${y.value.hourly_log_id}/edit`,class:"underline font-medium"},{default:H(()=>[...e[12]||(e[12]=[a(" Edit existing entry ",-1)])]),_:1},8,["href"]),e[13]||(e[13]=a(" instead? ",-1))])])])])):p("",!0),t("form",{onSubmit:$(R,["prevent"]),class:"space-y-6"},[t("div",ee,[e[22]||(e[22]=t("h2",{class:"text-lg font-semibold mb-4"},"Select Production & Time",-1)),t("div",te,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium mb-2"},[a("Date "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),type:"date",class:"input w-full",required:""},null,512),[[c,w.value]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},[a("Hour "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>h.value=l),class:"input w-full",required:""},[(n(!0),r(k,null,q(o(F),l=>(n(),r("option",{key:l.value,value:l.value},u(l.label),9,le))),128))],512),[[S,h.value,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium mb-2"},[a("Production "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),class:"input w-full",required:""},[e[18]||(e[18]=t("option",{value:null},"-- Select Production --",-1)),(n(!0),r(k,null,q(v.productions,l=>(n(),r("option",{key:l.production_id,value:l.production_id},u(l.production_name),9,se))),128))],512),[[S,_.value,void 0,{number:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium mb-2"},[a("Machine Group "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),class:"input w-full",required:"",disabled:!_.value},[e[20]||(e[20]=t("option",{value:null},"-- Select Machine Group --",-1)),(n(!0),r(k,null,q(D.value,l=>(n(),r("option",{key:l.production_machine_group_id,value:l.production_machine_group_id},u(l.name)+" ("+u(l.machine_count)+" machines) ",9,re))),128))],8,oe),[[S,b.value,void 0,{number:!0}]])])])]),V.value?(n(),r("div",ne,[e[32]||(e[32]=t("h2",{class:"text-lg font-semibold mb-4"},"Production Output",-1)),t("p",ue,[e[23]||(e[23]=a(" Input type: ",-1)),t("strong",null,u(m.value?.type??"qty_only"),1)]),!m.value||m.value.type==="qty_only"?(n(),r("div",de,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium mb-2"},[a("Quantity "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o(s).qty=l),type:"number",min:"0",class:"input w-full max-w-xs",required:""},null,512),[[c,o(s).qty,void 0,{number:!0}]]),o(s).errors.qty?(n(),r("p",ae,u(o(s).errors.qty),1)):p("",!0)])])):m.value.type==="normal_reject"?(n(),r("div",ie,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium mb-2"},[a("Normal Quantity "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>o(s).qty_normal=l),type:"number",min:"0",class:"input w-full",required:""},null,512),[[c,o(s).qty_normal,void 0,{number:!0}]]),o(s).errors.qty_normal?(n(),r("p",me,u(o(s).errors.qty_normal),1)):p("",!0)]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium mb-2"},"Reject Quantity",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>o(s).qty_reject=l),type:"number",min:"0",class:"input w-full"},null,512),[[c,o(s).qty_reject,void 0,{number:!0}]]),o(s).errors.qty_reject?(n(),r("p",pe,u(o(s).errors.qty_reject),1)):p("",!0)])])):m.value.type==="grades"?(n(),r("div",ce,[t("div",ve,[(n(!0),r(k,null,q(m.value.grade_types,l=>(n(),r("div",{key:l},[t("label",be,u(l),1),i(t("input",{"onUpdate:modelValue":A=>o(s).grades[l]=A,type:"number",min:"0",class:"input w-full"},null,8,ye),[[c,o(s).grades[l],void 0,{number:!0}]])]))),128))])])):m.value.type==="grade_qty"?(n(),r("div",ge,[t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium mb-2"},[a("Grade "),t("span",{class:"text-red-500"},"*")],-1)),i(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>o(s).grade=l),class:"input w-full",required:""},[e[27]||(e[27]=t("option",{value:null},"-- Select Grade --",-1)),(n(!0),r(k,null,q(m.value.grade_types,l=>(n(),r("option",{key:l,value:l},u(l),9,fe))),128))],512),[[S,o(s).grade]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium mb-2"},[a("Quantity "),t("span",{class:"text-red-500"},"*")],-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=l=>o(s).qty=l),type:"number",min:"0",class:"input w-full",required:""},null,512),[[c,o(s).qty,void 0,{number:!0}]])])])):p("",!0),t("div",xe,[M.value.includes("ukuran")?(n(),r("div",ke,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium mb-2"},"Ukuran (Size)",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>o(s).ukuran=l),type:"text",class:"input w-full",placeholder:"e.g., 122x244"},null,512),[[c,o(s).ukuran]])])):p("",!0),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium mb-2"},"Notes (Keterangan)",-1)),i(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=l=>o(s).keterangan=l),class:"input w-full",rows:"2",placeholder:"Optional notes..."},null,512),[[c,o(s).keterangan]])])])])):p("",!0),t("div",_e,[t("button",{type:"submit",class:"btn",disabled:o(s).processing||!b.value},u(o(s).processing?"Saving...":"Save Input"),9,we),t("button",{type:"button",class:"btn btn-ghost",onClick:e[11]||(e[11]=l=>o(N).get("/input"))}," Cancel ")])],32)])]),_:1})],64))}});export{Ee as default};
