import{d as J,g as b,f as y,B as p,c as m,m as r,u as l,p as K,w as i,a,q as w,z as L,L as $,t as d,o as c,F as h,i as q,e as C}from"./app-D4NX6RtZ.js";import{a as F,b as N,c as T,d as j,_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNNNqqjX.js";import{_ as W}from"./DataTable.vue_vue_type_script_setup_true_lang-bzC7JgnF.js";import{F as X}from"./file-down-B0oRyUMZ.js";import{C as D}from"./chevron-down-D-IdcPDr.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzC2dvNG.js";import"./Presence-CsGVf8pY.js";import"./createLucideIcon-A0T1vukc.js";import"./useForwardPropsEmits-BmzqlngZ.js";import"./x-XD7JAbQb.js";import"./VisuallyHidden-BeURpiPp.js";import"./index-C4J_hXM0.js";import"./Input.vue_vue_type_script_setup_true_lang-BWEJuRad.js";import"./Spinner.vue_vue_type_script_setup_true_lang-BqsWXN44.js";import"./search-DA59VARU.js";const Y={class:"p-4 space-y-4"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center gap-3 mb-3 flex-wrap"},te={class:"flex items-center gap-2"},ae=["disabled"],oe=["disabled"],se=["onClick"],le={class:"flex items-center gap-2"},re=["disabled"],ne=["disabled"],ie=["onClick"],ue=["disabled"],de={key:0,class:"flex flex-col"},ce={class:"font-medium"},pe={class:"text-xs text-red-500"},me={key:1,class:"flex flex-col"},_e={class:"font-medium"},fe={class:"text-xs text-muted-foreground"},be={class:"mt-4 flex items-center justify-end gap-2"},ve=["disabled"],ge=["disabled"],Pe=J({__name:"GroupLogs",props:{logs:{},meta:{}},setup(P){const V=[{title:"Logs",href:"/logs"},{title:"Group Logs",href:"/logs/group"}],t=P,n=b(!1),_=b(t.meta?.date_from?.split(" ")[0]??""),v=b(t.meta?.date_from?parseInt(t.meta.date_from.split(" ")[1]?.split(":")[0]||"0"):0),f=b(t.meta?.date_to?.split(" ")[0]??""),g=b(t.meta?.date_to?parseInt(t.meta.date_to.split(" ")[1]?.split(":")[0]||"23"):23),B=y(()=>t.logs?.data??[]),x=Array.from({length:24},(e,o)=>({value:o,label:`${o.toString().padStart(2,"0")}:00`})),E=y(()=>x.find(e=>e.value===v.value)?.label??"00:00"),G=y(()=>x.find(e=>e.value===g.value)?.label??"23:00"),z=e=>{v.value=e},H=e=>{g.value=e},M=e=>{const o=t.meta?.per_page??20,s=t.meta?.sort??"recorded_hour",u=t.meta?.direction??"desc";p.get(window.location.pathname,{q:e,per_page:o,sort:s,direction:u,date_from:t.meta?.date_from??null,date_to:t.meta?.date_to??null},{preserveState:!0,replace:!0})},U=({sort:e,direction:o})=>{const s=t.meta?.per_page??20,u=t.meta?.q??"";e&&p.get(window.location.pathname,{sort:e,direction:o??"desc",per_page:s,q:u,date_from:t.meta?.date_from??null,date_to:t.meta?.date_to??null},{preserveState:!0,replace:!0})},k=(e,o)=>e?`${e} ${o.toString().padStart(2,"0")}:00:00`:null,S=(e,o)=>e?`${e} ${o.toString().padStart(2,"0")}:59:59`:null,A=()=>{const e=t.meta?.per_page??20,o=t.meta?.sort??"recorded_hour",s=t.meta?.direction??"desc";p.get(window.location.pathname,{date_from:k(_.value||null,v.value),date_to:S(f.value||null,g.value),q:t.meta?.q??"",sort:o,direction:s,per_page:e},{preserveState:!0,replace:!0})},I=()=>{const e=t.logs?.next_page;e&&p.visit(e,{preserveState:!0,replace:!0})},O=()=>{const e=t.logs?.prev_page;e&&p.visit(e,{preserveState:!0,replace:!0})},R=()=>{const e=new URLSearchParams;_.value&&e.append("date_from",k(_.value,v.value)||""),f.value&&e.append("date_to",S(f.value,g.value)||""),t.meta?.q&&e.append("q",t.meta.q),window.location.href=`/logs/group/export?${e.toString()}`};return p.on("start",()=>n.value=!0),p.on("finish",()=>n.value=!1),(e,o)=>(c(),m(h,null,[r(l(K),{title:"Group Logs"}),r(Q,{breadcrumbs:V},{default:i(()=>[a("div",Y,[a("div",Z,[o[3]||(o[3]=a("div",null,[a("h2",{class:"text-2xl font-semibold"},"Group Logs (hourly)"),a("p",{class:"text-sm text-muted-foreground"},"Sums per machine group per hour")],-1)),a("button",{onClick:R,class:"btn-secondary flex items-center gap-2"},[r(l(X),{class:"size-4"}),o[2]||(o[2]=w(" Export to Excel ",-1))])]),a("div",ee,[a("div",te,[o[4]||(o[4]=a("label",{class:"text-sm font-medium"},"From",-1)),L(a("input",{type:"date",class:"input","onUpdate:modelValue":o[0]||(o[0]=s=>_.value=s),disabled:n.value},null,8,ae),[[$,_.value]]),r(l(F),null,{default:i(()=>[r(l(N),{"as-child":!0},{default:i(()=>[a("button",{type:"button",class:"input flex items-center justify-between",disabled:n.value},[a("span",null,d(E.value),1),r(l(D),{class:"ml-2 size-4"})],8,oe)]),_:1}),r(l(T),{class:"min-w-[8rem]"},{default:i(()=>[(c(!0),m(h,null,q(l(x),s=>(c(),C(l(j),{"as-child":!0,key:s.value},{default:i(()=>[a("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:u=>z(s.value)},d(s.label),9,se)]),_:2},1024))),128))]),_:1})]),_:1})]),a("div",le,[o[5]||(o[5]=a("label",{class:"text-sm font-medium"},"To",-1)),L(a("input",{type:"date",class:"input","onUpdate:modelValue":o[1]||(o[1]=s=>f.value=s),disabled:n.value},null,8,re),[[$,f.value]]),r(l(F),null,{default:i(()=>[r(l(N),{"as-child":!0},{default:i(()=>[a("button",{type:"button",class:"input flex items-center justify-between",disabled:n.value},[a("span",null,d(G.value),1),r(l(D),{class:"ml-2 size-4"})],8,ne)]),_:1}),r(l(T),{class:"min-w-[8rem]"},{default:i(()=>[(c(!0),m(h,null,q(l(x),s=>(c(),C(l(j),{"as-child":!0,key:s.value},{default:i(()=>[a("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:u=>H(s.value)},d(s.label),9,ie)]),_:2},1024))),128))]),_:1})]),_:1})]),a("button",{class:"hover:cursor-pointer btn",onClick:A,disabled:n.value},"Apply",8,ue)]),r(W,{serverMode:"",data:B.value,columns:[{key:"recorded_hour",label:"Hour",type:"string",sortable:!0,findable:!1},{key:"production_name",label:"Production",type:"string",sortable:!0,findable:!0},{key:"machine_group_name",label:"Machine Group",type:"string",sortable:!0,findable:!0},{key:"total_target",label:"Target",type:"number",sortable:!0,findable:!1},{key:"total_output",label:"Output",type:"number",sortable:!0,findable:!1},{key:"variance",label:"Variance",type:"number",sortable:!1,findable:!1}],"per-page":20,"initial-sort":t.meta?.sort??"recorded_hour","initial-direction":t.meta?.direction??"desc",loading:n.value,onServerSearch:M,onServerSort:U},{cell:i(({row:s,column:u})=>[u.key==="total_output"?(c(),m("div",de,[a("span",ce,d(Number(s.total_output_qty_normal??0).toLocaleString()),1),a("span",pe,"rej: "+d(Number(s.total_output_qty_reject??0).toLocaleString()),1)])):u.key==="total_target"?(c(),m("div",me,[a("span",_e,d(Number(s.total_target_qty_normal??0).toLocaleString()),1),a("span",fe,"rej: "+d(Number(s.total_target_qty_reject??0).toLocaleString()),1)])):(c(),m(h,{key:2},[w(d(s[u.key]),1)],64))]),_:1},8,["data","initial-sort","initial-direction","loading"]),a("div",be,[a("button",{class:"hover:cursor-pointer btn",disabled:!t.logs?.prev_page||n.value,onClick:O},"Previous",8,ve),a("button",{class:"hover:cursor-pointer btn",disabled:!t.logs?.next_page||n.value,onClick:I},"Next",8,ge)])])]),_:1})],64))}});export{Pe as default};
