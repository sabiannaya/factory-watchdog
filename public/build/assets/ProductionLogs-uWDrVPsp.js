import{d as J,g as v,f as y,B as p,c as m,m as r,u as l,p as K,w as i,a,q as w,z as L,L as $,t as d,o as c,F as h,i as q,e as C}from"./app-BRuhaguS.js";import{a as P,b as F,c as N,d as T,_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-BSta2Xg1.js";import{_ as W}from"./DataTable.vue_vue_type_script_setup_true_lang-BGxGevKE.js";import{F as X}from"./file-down-D61wkUlP.js";import{C as j}from"./chevron-down-Bi0ueEnd.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DrUmFdxY.js";import"./Presence-CRPloLVK.js";import"./createLucideIcon-Bc86gjbu.js";import"./useForwardPropsEmits-CxMGla6T.js";import"./x-Dz_x2_zF.js";import"./VisuallyHidden-gDrgz296.js";import"./index-C4J_hXM0.js";import"./Input.vue_vue_type_script_setup_true_lang-Bolxw2JV.js";import"./Spinner.vue_vue_type_script_setup_true_lang-BLCXa5KB.js";import"./search-DqEYQ3zn.js";const Y={class:"p-4 space-y-4"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center gap-3 mb-3 flex-wrap"},te={class:"flex items-center gap-2"},ae=["disabled"],oe=["disabled"],se=["onClick"],le={class:"flex items-center gap-2"},re=["disabled"],ne=["disabled"],ie=["onClick"],ue=["disabled"],de={key:0,class:"flex flex-col"},ce={class:"font-medium"},pe={class:"text-xs text-red-500"},me={key:1,class:"flex flex-col"},_e={class:"font-medium"},fe={class:"text-xs text-muted-foreground"},ve={class:"mt-4 flex items-center justify-end gap-2"},be=["disabled"],ge=["disabled"],De=J({__name:"ProductionLogs",props:{logs:{},meta:{}},setup(D){const V=[{title:"Logs",href:"/logs"},{title:"Production Logs",href:"/logs/production"}],t=D,n=v(!1),_=v(t.meta?.date_from?.split(" ")[0]??""),b=v(t.meta?.date_from?parseInt(t.meta.date_from.split(" ")[1]?.split(":")[0]||"0"):0),f=v(t.meta?.date_to?.split(" ")[0]??""),g=v(t.meta?.date_to?parseInt(t.meta.date_to.split(" ")[1]?.split(":")[0]||"23"):23),B=y(()=>t.logs?.data??[]),x=Array.from({length:24},(e,o)=>({value:o,label:`${o.toString().padStart(2,"0")}:00`})),E=y(()=>x.find(e=>e.value===b.value)?.label??"00:00"),z=y(()=>x.find(e=>e.value===g.value)?.label??"23:00"),H=e=>{b.value=e},U=e=>{g.value=e},A=e=>{const o=t.meta?.per_page??20,s=t.meta?.sort??"recorded_hour",u=t.meta?.direction??"desc";p.get(window.location.pathname,{q:e,per_page:o,sort:s,direction:u,date_from:t.meta?.date_from??null,date_to:t.meta?.date_to??null},{preserveState:!0,replace:!0})},I=({sort:e,direction:o})=>{const s=t.meta?.per_page??20,u=t.meta?.q??"";e&&p.get(window.location.pathname,{sort:e,direction:o??"desc",per_page:s,q:u,date_from:t.meta?.date_from??null,date_to:t.meta?.date_to??null},{preserveState:!0,replace:!0})},k=(e,o)=>e?`${e} ${o.toString().padStart(2,"0")}:00:00`:null,S=(e,o)=>e?`${e} ${o.toString().padStart(2,"0")}:59:59`:null,M=()=>{const e=t.meta?.per_page??20,o=t.meta?.sort??"recorded_hour",s=t.meta?.direction??"desc";p.get(window.location.pathname,{date_from:k(_.value||null,b.value),date_to:S(f.value||null,g.value),q:t.meta?.q??"",sort:o,direction:s,per_page:e},{preserveState:!0,replace:!0})},O=()=>{const e=t.logs?.next_page;e&&p.visit(e,{preserveState:!0,replace:!0})},R=()=>{const e=t.logs?.prev_page;e&&p.visit(e,{preserveState:!0,replace:!0})},G=()=>{const e=new URLSearchParams;_.value&&e.append("date_from",k(_.value,b.value)||""),f.value&&e.append("date_to",S(f.value,g.value)||""),t.meta?.q&&e.append("q",t.meta.q),window.location.href=`/logs/production/export?${e.toString()}`};return p.on("start",()=>n.value=!0),p.on("finish",()=>n.value=!1),(e,o)=>(c(),m(h,null,[r(l(K),{title:"Production Logs"}),r(Q,{breadcrumbs:V},{default:i(()=>[a("div",Y,[a("div",Z,[o[3]||(o[3]=a("div",null,[a("h2",{class:"text-2xl font-semibold"},"Production Logs (hourly)"),a("p",{class:"text-sm text-muted-foreground"},"Sums per production per hour")],-1)),a("button",{onClick:G,class:"btn-secondary flex items-center gap-2"},[r(l(X),{class:"size-4"}),o[2]||(o[2]=w(" Export to Excel ",-1))])]),a("div",ee,[a("div",te,[o[4]||(o[4]=a("label",{class:"text-sm font-medium"},"From",-1)),L(a("input",{type:"date",class:"input","onUpdate:modelValue":o[0]||(o[0]=s=>_.value=s),disabled:n.value},null,8,ae),[[$,_.value]]),r(l(P),null,{default:i(()=>[r(l(F),{"as-child":!0},{default:i(()=>[a("button",{type:"button",class:"input flex items-center justify-between",disabled:n.value},[a("span",null,d(E.value),1),r(l(j),{class:"ml-2 size-4"})],8,oe)]),_:1}),r(l(N),{class:"min-w-[8rem]"},{default:i(()=>[(c(!0),m(h,null,q(l(x),s=>(c(),C(l(T),{"as-child":!0,key:s.value},{default:i(()=>[a("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:u=>H(s.value)},d(s.label),9,se)]),_:2},1024))),128))]),_:1})]),_:1})]),a("div",le,[o[5]||(o[5]=a("label",{class:"text-sm font-medium"},"To",-1)),L(a("input",{type:"date",class:"input","onUpdate:modelValue":o[1]||(o[1]=s=>f.value=s),disabled:n.value},null,8,re),[[$,f.value]]),r(l(P),null,{default:i(()=>[r(l(F),{"as-child":!0},{default:i(()=>[a("button",{type:"button",class:"input flex items-center justify-between",disabled:n.value},[a("span",null,d(z.value),1),r(l(j),{class:"ml-2 size-4"})],8,ne)]),_:1}),r(l(N),{class:"min-w-[8rem]"},{default:i(()=>[(c(!0),m(h,null,q(l(x),s=>(c(),C(l(T),{"as-child":!0,key:s.value},{default:i(()=>[a("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:u=>U(s.value)},d(s.label),9,ie)]),_:2},1024))),128))]),_:1})]),_:1})]),a("button",{class:"hover:cursor-pointer btn",onClick:M,disabled:n.value},"Apply",8,ue)]),r(W,{serverMode:"",data:B.value,columns:[{key:"recorded_hour",label:"Hour",type:"string",sortable:!0,findable:!1},{key:"production_name",label:"Production",type:"string",sortable:!0,findable:!0},{key:"total_target",label:"Target",type:"number",sortable:!0,findable:!1},{key:"total_output",label:"Output",type:"number",sortable:!0,findable:!1},{key:"variance",label:"Variance",type:"number",sortable:!1,findable:!1}],"per-page":20,"initial-sort":t.meta?.sort??"recorded_hour","initial-direction":t.meta?.direction??"desc",loading:n.value,onServerSearch:A,onServerSort:I},{cell:i(({row:s,column:u})=>[u.key==="total_output"?(c(),m("div",de,[a("span",ce,d(Number(s.total_output_qty_normal??0).toLocaleString()),1),a("span",pe,"rej: "+d(Number(s.total_output_qty_reject??0).toLocaleString()),1)])):u.key==="total_target"?(c(),m("div",me,[a("span",_e,d(Number(s.total_target_qty_normal??0).toLocaleString()),1),a("span",fe,"rej: "+d(Number(s.total_target_qty_reject??0).toLocaleString()),1)])):(c(),m(h,{key:2},[w(d(s[u.key]),1)],64))]),_:1},8,["data","initial-sort","initial-direction","loading"]),a("div",ve,[a("button",{class:"hover:cursor-pointer btn",disabled:!t.logs?.prev_page||n.value,onClick:R},"Previous",8,be),a("button",{class:"hover:cursor-pointer btn",disabled:!t.logs?.next_page||n.value,onClick:O},"Next",8,ge)])])]),_:1})],64))}});export{De as default};
