import{d as y,v as w,g as _,l as C,c as j,m as l,u,p as O,w as S,a as n,y as $,t as k,B as f,F as q,o as D}from"./app-D4NX6RtZ.js";import{_ as B}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNNNqqjX.js";import{_ as M,a as T}from"./MachineGroupSelector.vue_vue_type_script_setup_true_lang-CL8ikNk5.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzC2dvNG.js";import"./Presence-CsGVf8pY.js";import"./createLucideIcon-A0T1vukc.js";import"./useForwardPropsEmits-BmzqlngZ.js";import"./x-XD7JAbQb.js";import"./VisuallyHidden-BeURpiPp.js";import"./index-C4J_hXM0.js";import"./chevron-down-D-IdcPDr.js";import"./search-DA59VARU.js";const U={class:"p-4 space-y-4"},F={class:"flex items-center gap-3 pt-4"},G=["disabled"],W=y({__name:"Edit",props:{production:{},machine_groups:{},attached_groups:{}},setup(g){const o=g,h=[{title:"Data Management",href:"/data-management/production"},{title:"Production",href:"/data-management/production"},{title:o.production?.production_name??"Edit",href:window.location.pathname}],r=w({production_name:o.production.production_name,status:o.production.status,target_date:null,machine_groups:[]}),c=_(null),s=_({}),m=_({});function d(e,t){const a={};return e&&Object.entries(e).forEach(([p,i])=>{if(p==="qty"){a.qty_normal=i;return}a[p]=i}),t!=null&&a.qty_normal===void 0&&(a.qty_normal=t),a}C(()=>{const e={};o.attached_groups&&Object.values(o.attached_groups).forEach(t=>{e[t.machine_group_id]={machine_group_id:t.machine_group_id,machine_count:t.machine_count,targets:d(t.default_targets,t.default_target),default_targets:d(t.default_targets,t.default_target)}}),s.value=e});function v(e){s.value=e}function b(e){c.value=e}function E(){m.value={};let e=!0;return Object.values(s.value).forEach(t=>{const a={};(!t.machine_count||t.machine_count<1)&&(a.machine_count=["Machine count must be at least 1"],e=!1),c.value&&(Object.values(t.targets).some(i=>i!=null)||(a.targets=["At least one target is required when target date is set"],e=!1)),Object.keys(a).length>0&&(m.value[t.machine_group_id]=a)}),e}function x(){E()&&(r.target_date=c.value,r.machine_groups=Object.values(s.value).map(e=>({...e,targets:d(e.targets),default_targets:d(e.default_targets)})),r.put(`/data-management/production/${o.production.production_id}`,{preserveState:!1,onSuccess:()=>{f.get("/data-management/production")}}))}return(e,t)=>(D(),j(q,null,[l(u(O),{title:`Edit Production â€” ${o.production.production_name}`},null,8,["title"]),l(B,{breadcrumbs:h},{default:S(()=>[n("div",U,[t[1]||(t[1]=n("div",null,[n("h1",{class:"text-3xl font-bold"},"Edit Production"),n("p",{class:"text-muted-foreground dark:text-muted-foreground"}," Configure production details and attach machine groups with targets ")],-1)),n("form",{onSubmit:$(x,["prevent"]),class:"space-y-6"},[l(M,{form:u(r)},null,8,["form"]),l(T,{"machine-groups":o.machine_groups||[],"attached-groups":s.value,"target-date":c.value,errors:m.value,"onUpdate:attachedGroups":v,"onUpdate:targetDate":b},null,8,["machine-groups","attached-groups","target-date","errors"]),n("div",F,[n("button",{type:"submit",class:"hover:cursor-pointer btn",disabled:u(r).processing},k(u(r).processing?"Saving...":"Save Changes"),9,G),n("button",{type:"button",class:"btn btn-ghost",onClick:t[0]||(t[0]=a=>u(f).get("/data-management/production"))}," Cancel ")])],32)])]),_:1})],64))}});export{W as default};
