import{d as F,g as _,f as L,B as u,c as p,m,u as b,p as V,w as v,a,q as y,z as x,L as k,o as c,t as d,n as E,F as S}from"./app-D4NX6RtZ.js";import{_ as $}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNNNqqjX.js";import{_ as A}from"./DataTable.vue_vue_type_script_setup_true_lang-bzC7JgnF.js";import{F as B}from"./file-down-B0oRyUMZ.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzC2dvNG.js";import"./Presence-CsGVf8pY.js";import"./createLucideIcon-A0T1vukc.js";import"./useForwardPropsEmits-BmzqlngZ.js";import"./x-XD7JAbQb.js";import"./VisuallyHidden-BeURpiPp.js";import"./index-C4J_hXM0.js";import"./Input.vue_vue_type_script_setup_true_lang-BWEJuRad.js";import"./Spinner.vue_vue_type_script_setup_true_lang-BqsWXN44.js";import"./search-DA59VARU.js";const z={class:"p-4 space-y-4"},O={class:"flex items-center justify-between"},R={class:"flex items-center gap-3 mb-3"},U=["disabled"],M=["disabled"],G=["disabled"],I={key:0,class:"flex flex-col items-end"},H={class:"font-medium"},J={class:"text-xs text-red-500"},K={key:1,class:"flex flex-col items-end"},Q={class:"font-medium"},W={class:"text-xs text-muted-foreground"},X={class:"mt-4 flex items-center justify-end gap-2"},Y=["disabled"],Z=["disabled"],_e=F({__name:"Productions",props:{aggregates:{},meta:{}},setup(h){const q=[{title:"Summary",href:"/summary/productions"},{title:"Production Summary",href:"/summary/productions"}],t=h,s=_(!1),n=_(t.meta?.date_from??""),i=_(t.meta?.date_to??""),T=L(()=>t.aggregates?.data??[]),N=e=>{const o=t.meta?.per_page??20,r=t.meta?.sort??"total_output",l=t.meta?.direction??"desc";u.get(window.location.pathname,{q:e,per_page:o,sort:r,direction:l,date_from:n.value,date_to:i.value},{preserveState:!0,replace:!0})},P=({sort:e,direction:o})=>{const r=t.meta?.per_page??20,l=t.meta?.q??"";e&&u.get(window.location.pathname,{sort:e,direction:o??"desc",per_page:r,q:l,date_from:n.value,date_to:i.value},{preserveState:!0,replace:!0})},f=e=>e?e.includes("T")?e.replace("T"," ")+":00":`${e} 00:00:00`:null,g=e=>e?e.includes("T")?e.replace("T"," ")+":00":`${e} 23:59:59`:null,j=()=>{const e=t.meta?.per_page??20,o=t.meta?.sort??"total_output",r=t.meta?.direction??"desc";u.get(window.location.pathname,{date_from:f(n.value||null),date_to:g(i.value||null),q:t.meta?.q??"",sort:o,direction:r,per_page:e},{preserveState:!0,replace:!0})},w=()=>{const e=t.aggregates?.next_page;e&&u.visit(e,{preserveState:!0,replace:!0})},C=()=>{const e=t.aggregates?.prev_page;e&&u.visit(e,{preserveState:!0,replace:!0})},D=()=>{const e=new URLSearchParams;n.value&&e.append("date_from",f(n.value)||""),i.value&&e.append("date_to",g(i.value)||""),t.meta?.q&&e.append("q",t.meta.q),window.location.href=`/summary/productions/export?${e.toString()}`};return u.on("start",()=>s.value=!0),u.on("finish",()=>s.value=!1),(e,o)=>(c(),p(S,null,[m(b(V),{title:"Production Aggregates"}),m($,{breadcrumbs:q},{default:v(()=>[a("div",z,[a("div",O,[o[3]||(o[3]=a("div",null,[a("h2",{class:"text-2xl font-semibold"},"Production Aggregates"),a("p",{class:"text-sm text-muted-foreground"},"Aggregated output per production (sums across groups)")],-1)),a("button",{onClick:D,class:"btn-secondary flex items-center gap-2"},[m(b(B),{class:"size-4"}),o[2]||(o[2]=y(" Export to Excel ",-1))])]),a("div",R,[o[4]||(o[4]=a("label",{class:"text-sm"},"From",-1)),x(a("input",{type:"date",class:"input","onUpdate:modelValue":o[0]||(o[0]=r=>n.value=r),disabled:s.value},null,8,U),[[k,n.value]]),o[5]||(o[5]=a("label",{class:"text-sm"},"To",-1)),x(a("input",{type:"date",class:"input","onUpdate:modelValue":o[1]||(o[1]=r=>i.value=r),disabled:s.value},null,8,M),[[k,i.value]]),a("button",{class:"hover:cursor-pointer btn",onClick:j,disabled:s.value},"Apply",8,G)]),m(A,{serverMode:"",data:T.value,columns:[{key:"production_id",label:"ID",type:"number",sortable:!1,findable:!1},{key:"production_name",label:"Production",type:"string",sortable:!0,findable:!0},{key:"group_count",label:"Groups",type:"number",sortable:!0,findable:!1},{key:"total_target_qty_normal",label:"Target Normal",type:"number",sortable:!0,findable:!1},{key:"total_target_qty_reject",label:"Target Reject",type:"number",sortable:!0,findable:!1},{key:"total_output_qty_normal",label:"Output Normal",type:"number",sortable:!0,findable:!1},{key:"total_output_qty_reject",label:"Output Reject",type:"number",sortable:!0,findable:!1},{key:"total_target",label:"Target Total",type:"number",sortable:!0,findable:!1},{key:"total_output",label:"Total Output",type:"number",sortable:!0,findable:!1},{key:"variance",label:"Variance",type:"number",sortable:!1,findable:!1}],"per-page":20,"initial-sort":t.meta?.sort??"total_output","initial-direction":t.meta?.direction??"desc",loading:s.value,onServerSearch:N,onServerSort:P},{cell:v(({row:r,column:l})=>[l.key==="total_output"?(c(),p("div",I,[a("span",H,d(Number(r.total_output_qty_normal??0).toLocaleString()),1),a("span",J,"rej: "+d(Number(r.total_output_qty_reject??0).toLocaleString()),1)])):l.key==="total_target"?(c(),p("div",K,[a("span",Q,d(Number(r.total_target_qty_normal??0).toLocaleString()),1),a("span",W,"rej: "+d(Number(r.total_target_qty_reject??0).toLocaleString()),1)])):l.key==="variance"?(c(),p("span",{key:2,class:E((r.variance??0)>=0?"text-emerald-600 font-medium":"text-red-600 font-medium")},d((r.variance>=0?"+":"")+Number(r.variance??0).toLocaleString()),3)):(c(),p(S,{key:3},[y(d(r[l.key]),1)],64))]),_:1},8,["data","initial-sort","initial-direction","loading"]),a("div",X,[a("button",{class:"hover:cursor-pointer btn",disabled:!t.aggregates?.prev_page||s.value,onClick:C},"Previous",8,Y),a("button",{class:"hover:cursor-pointer btn",disabled:!t.aggregates?.next_page||s.value,onClick:w},"Next",8,Z)])])]),_:1})],64))}});export{_e as default};
