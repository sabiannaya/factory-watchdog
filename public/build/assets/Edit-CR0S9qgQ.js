import{d as w,f as E,v as O,g as f,l as k,c as q,m as l,u as n,p as B,w as C,a as s,t as _,y as D,B as h,F as S,o as T}from"./app-i1_2c9TI.js";import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-UWREGGXY.js";import{u as z}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B0bB4Y56.js";import{_ as F,a as G}from"./MachineGroupSelector.vue_vue_type_script_setup_true_lang-BTimB4k4.js";import"./VisuallyHidden-CgfYLdxu.js";import"./index-C4J_hXM0.js";import"./x-T-BkQ4N0.js";import"./chevron-down-C8FjIUWp.js";import"./search-BWjjXBCD.js";const M={class:"p-4 space-y-4"},A={class:"text-3xl font-bold"},N={class:"text-muted-foreground dark:text-muted-foreground"},V={class:"flex items-center gap-3 pt-4"},L=["disabled"],Y=w({__name:"Edit",props:{production:{},machine_groups:{},attached_groups:{}},setup(v){const r=v,{t:o}=z(),b=E(()=>[{title:o("data_management.data_management"),href:"/data-management/production"},{title:o("data_management.production"),href:"/data-management/production"},{title:r.production?.production_name??o("data_management.edit"),href:window.location.pathname}]),i=O({production_name:r.production.production_name,status:r.production.status,target_date:null,machine_groups:[]}),d=f(null),u=f({}),p=f({});function m(e,t){const a={};return e&&Object.entries(e).forEach(([g,c])=>{if(g==="qty"){a.qty_normal=c;return}a[g]=c}),t!=null&&a.qty_normal===void 0&&(a.qty_normal=t),a}k(()=>{const e={};r.attached_groups&&Object.values(r.attached_groups).forEach(t=>{e[t.machine_group_id]={machine_group_id:t.machine_group_id,machine_count:t.machine_count,targets:m(t.default_targets,t.default_target),default_targets:m(t.default_targets,t.default_target)}}),u.value=e});function x(e){u.value=e}function y(e){d.value=e}function $(){p.value={};let e=!0;return Object.values(u.value).forEach(t=>{const a={};(!t.machine_count||t.machine_count<1)&&(a.machine_count=["Machine count must be at least 1"],e=!1),d.value&&(Object.values(t.targets).some(c=>c!=null)||(a.targets=["At least one target is required when target date is set"],e=!1)),Object.keys(a).length>0&&(p.value[t.machine_group_id]=a)}),e}function j(){$()&&(i.target_date=d.value,i.machine_groups=Object.values(u.value).map(e=>({...e,targets:m(e.targets),default_targets:m(e.default_targets)})),i.put(`/data-management/production/${r.production.production_id}`,{preserveState:!1,onSuccess:()=>{h.get("/data-management/production")}}))}return(e,t)=>(T(),q(S,null,[l(n(B),{title:`${n(o)("data_management.edit_production")} â€” ${r.production.production_name}`},null,8,["title"]),l(U,{breadcrumbs:b.value},{default:C(()=>[s("div",M,[s("div",null,[s("h1",A,_(n(o)("data_management.edit_production")),1),s("p",N,_(n(o)("data_management.edit_production_description")),1)]),s("form",{onSubmit:D(j,["prevent"]),class:"space-y-6"},[l(F,{form:n(i)},null,8,["form"]),l(G,{"machine-groups":r.machine_groups||[],"attached-groups":u.value,"target-date":d.value,errors:p.value,"onUpdate:attachedGroups":x,"onUpdate:targetDate":y},null,8,["machine-groups","attached-groups","target-date","errors"]),s("div",V,[s("button",{type:"submit",class:"hover:cursor-pointer btn",disabled:n(i).processing},_(n(i).processing?n(o)("data_management.saving"):n(o)("data_management.save_changes")),9,L),s("button",{type:"button",class:"btn btn-ghost",onClick:t[0]||(t[0]=a=>n(h).get("/data-management/production"))},_(n(o)("data_management.cancel")),1)])],32)])]),_:1},8,["breadcrumbs"])],64))}});export{Y as default};
