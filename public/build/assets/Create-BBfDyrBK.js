import{d as ct,f as v,g,x as P,c as d,m as i,u as t,p as pt,w as c,a as e,b as m,t as o,o as r,q as p,s as mt,y as _t,z as w,L as C,F as h,i as y,e as L,B as et}from"./app-i1_2c9TI.js";import{_ as ft}from"./AppLayout.vue_vue_type_script_setup_true_lang-UWREGGXY.js";import{u as vt}from"./useHourlyInputForm-BnG_B82D.js";import{u as bt,_ as G,a as T,b as z,d as q}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B0bB4Y56.js";import{_ as gt,a as ht,b as yt,c as kt,d as xt,e as wt,f as Ct}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-B5Z9-k2f.js";import{_ as qt}from"./ToastNotifications.vue_vue_type_script_setup_true_lang-mcyszUyt.js";import{u as $t}from"./useToast-C_zToptU.js";import{C as H}from"./chevron-down-C8FjIUWp.js";import"./VisuallyHidden-CgfYLdxu.js";import"./index-C4J_hXM0.js";import"./x-T-BkQ4N0.js";const jt={class:"p-4 space-y-6"},Nt={class:"text-2xl font-bold"},St={class:"text-muted-foreground"},Vt={key:0,class:"rounded-lg bg-destructive/10 border border-destructive/30 p-4"},Dt={class:"text-destructive font-medium"},Ut={key:1,class:"rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-300 dark:border-amber-700 p-4"},Lt={class:"flex items-start gap-3"},Gt={class:"font-medium text-amber-800 dark:text-amber-200"},Tt={class:"text-sm text-amber-700 dark:text-amber-300 mt-1"},zt={class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},Ht={class:"text-lg font-semibold mb-4"},Et={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ft={class:"block text-sm font-medium mb-2"},It={class:"block text-sm font-medium mb-2"},Bt={type:"button",class:"input w-full flex items-center justify-between",required:""},Mt=["onClick"],Pt={class:"block text-sm font-medium mb-2"},Ot={type:"button",class:"input w-full flex items-center justify-between",required:""},At={class:"truncate"},Rt=["onClick"],Jt={class:"block text-sm font-medium mb-2"},Kt=["disabled"],Xt={class:"truncate"},Qt=["onClick"],Wt={key:0,class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},Yt={class:"text-lg font-semibold mb-4"},Zt={class:"text-sm text-muted-foreground mb-4"},te={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee={class:"block text-sm font-medium mb-2"},se={key:0,class:"text-red-500 text-sm mt-1"},oe={class:"block text-sm font-medium mb-2"},le={key:0,class:"text-red-500 text-sm mt-1"},ue={key:1,class:"space-y-4 mt-4"},ne={class:"block text-sm font-medium mb-2"},ae={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},re={class:"block text-sm font-medium mb-2"},ie=["onUpdate:modelValue"],de={class:"block text-sm font-medium mb-2"},ce=["onUpdate:modelValue"],pe={key:2,class:"space-y-4 mt-4"},me={class:"block text-sm font-medium mb-2"},_e={type:"button",class:"input w-full flex items-center justify-between",required:""},fe=["onClick"],ve={class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4"},be={key:0},ge={class:"block text-sm font-medium mb-2"},he={class:"block text-sm font-medium mb-2"},ye={class:"flex items-center gap-3"},ke=["disabled"],xe={class:"mt-4 border-t pt-3"},we={class:"text-sm font-medium mb-2"},Ce={class:"rounded-lg bg-muted/50 p-3"},qe={class:"space-y-1 text-sm"},$e={key:0},je={key:1},Ne={key:2},Se={key:3,class:"grid grid-cols-2 gap-2 mt-1"},Ve={class:"font-medium"},De={class:"font-medium"},Ue={key:4},Le={key:5},Ge={class:"flex justify-end gap-2"},Re=ct({__name:"Create",props:{productions:{},selectedProductionId:{},selectedDate:{},selectedHour:{}},setup(st){const{t:n}=bt(),ot=v(()=>[{title:n("input.title"),href:"/input"},{title:n("input.record_input"),href:window.location.pathname}]),k=st,V=g(k.selectedProductionId),x=g(k.selectedDate),$=g(parseInt(String(k.selectedHour))||new Date().getHours()),b=g(null),lt=v(()=>k.productions.find(a=>a.production_id===V.value)),E=v(()=>lt.value?.machine_groups??[]),F=v(()=>E.value.find(a=>a.production_machine_group_id===b.value)),_=v(()=>F.value?.input_config),j=v(()=>F.value?.fields??[]),I=v(()=>{const a=_.value?.type??"qty_only";return a==="qty_only"||a==="normal_reject"||j.value.includes("qty_normal")||j.value.includes("qty_reject")}),B=v(()=>_.value?.type==="grades"||j.value.includes("grades")),O=v(()=>_.value?.type==="grade_qty"||j.value.includes("grade")),{form:u,setInputConfig:ut}=vt(void 0,null);u.date=x.value,u.hour=Number($.value);const{success:nt,error:A}=$t(),D=g(!1),U=g(!1),N=g(null),R=g(!1);let S;const M=g(!1),J=async()=>{if(!b.value||!x.value){N.value=null;return}R.value=!0;try{const s=await(await fetch("/input/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({production_machine_group_id:b.value,date:x.value,hour:$.value})})).json();N.value=s.exists?s.entry:null}catch(a){console.error("Error checking duplicate:",a)}finally{R.value=!1}};P(b,a=>{u.production_machine_group_id=a,ut(_.value),u.output_qty_normal=null,u.output_qty_reject=null,u.output_grades=u.output_grades??{},u.output_grade=null,u.output_ukuran=null,S&&clearTimeout(S),S=setTimeout(J,300)}),P([x,$],([a,s])=>{u.date=a,u.hour=Number(s),S&&clearTimeout(S),S=setTimeout(J,300)}),P(N,a=>{a&&!M.value&&(A("Existing entry found",`A record already exists for this machine group at ${a.recorded_at}`),M.value=!0),a||(M.value=!1)});const K=Array.from({length:24},(a,s)=>({value:s,label:`${s.toString().padStart(2,"0")}:00`})),X=v(()=>K.find(a=>a.value===Number($.value))?.label??`${String($.value).padStart(2,"0")}:00`),Q=v(()=>k.productions.find(a=>a.production_id===V.value)?.production_name??n("input.select_production")),W=v(()=>E.value.find(a=>a.production_machine_group_id===b.value)?.name??n("input.select_machine_group")),at=a=>{$.value=Number(a),u.hour=Number(a)},Y=a=>{if(V.value=a,b.value=null,a!==null){const s=k.productions.find(l=>l.production_id===a);s&&s.machine_groups&&s.machine_groups.length>0&&(b.value=s.machine_groups[0].production_machine_group_id)}},Z=a=>{b.value=a},rt=()=>{U.value=!0,u.post("/input",{onSuccess:()=>{nt("Input saved","Hourly input has been recorded"),et.get("/input",{date:u.date,production_id:V.value})},onError:()=>{A("Failed to save","There was an error saving the input")},onFinish:()=>{U.value=!1,D.value=!1}})},it=()=>{D.value=!0},tt=v(()=>!!u.errors.duplicate);return(a,s)=>(r(),d(h,null,[i(t(pt),{title:t(n)("input.create")},null,8,["title"]),i(ft,{breadcrumbs:ot.value},{default:c(()=>[e("div",jt,[e("div",null,[e("h1",Nt,o(t(n)("input.create")),1),e("p",St,o(t(n)("input.description")),1)]),tt.value?(r(),d("div",Vt,[e("p",Dt,o(t(u).errors.duplicate),1)])):m("",!0),N.value&&!tt.value?(r(),d("div",Ut,[e("div",Lt,[s[10]||(s[10]=e("svg",{class:"size-5 text-amber-600 dark:text-amber-400 mt-0.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",null,[e("p",Gt,o(t(n)("input.existing_entry")),1),e("p",Tt,[p(o(t(n)("input.entry_exists",{time:N.value.recorded_at}))+" ",1),i(t(mt),{href:`/input/${N.value.hourly_log_id}/edit`,class:"underline font-medium"},{default:c(()=>[p(o(t(n)("input.edit_existing")),1)]),_:1},8,["href"]),p(" "+o(t(n)("input.instead")),1)])])])])):m("",!0),e("form",{onSubmit:_t(it,["prevent"]),class:"space-y-6"},[e("div",zt,[e("h2",Ht,o(t(n)("input.select_production_time")),1),e("div",Et,[e("div",null,[e("label",Ft,[p(o(t(n)("app.date"))+" ",1),s[11]||(s[11]=e("span",{class:"text-red-500"},"*",-1))]),w(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>x.value=l),type:"date",class:"input w-full",required:""},null,512),[[C,x.value]])]),e("div",null,[e("label",It,[p(o(t(n)("app.hour"))+" ",1),s[12]||(s[12]=e("span",{class:"text-red-500"},"*",-1))]),i(t(G),null,{default:c(()=>[i(t(T),{"as-child":!0},{default:c(()=>[e("button",Bt,[e("span",null,o(X.value),1),i(t(H),{class:"ml-2 size-4"})])]),_:1}),i(t(z),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:c(()=>[(r(!0),d(h,null,y(t(K),l=>(r(),L(t(q),{"as-child":!0,key:l.value},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>at(l.value)},o(l.label),9,Mt)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",null,[e("label",Pt,[p(o(t(n)("input.production"))+" ",1),s[13]||(s[13]=e("span",{class:"text-red-500"},"*",-1))]),i(t(G),null,{default:c(()=>[i(t(T),{"as-child":!0},{default:c(()=>[e("button",Ot,[e("span",At,o(Q.value),1),i(t(H),{class:"ml-2 size-4"})])]),_:1}),i(t(z),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:c(()=>[i(t(q),{"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:s[1]||(s[1]=l=>Y(null))},o(t(n)("input.select_production")),1)]),_:1}),(r(!0),d(h,null,y(k.productions,l=>(r(),L(t(q),{key:l.production_id,"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>Y(l.production_id)},o(l.production_name),9,Rt)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",null,[e("label",Jt,[p(o(t(n)("input.machine_group"))+" ",1),s[14]||(s[14]=e("span",{class:"text-red-500"},"*",-1))]),i(t(G),null,{default:c(()=>[i(t(T),{"as-child":!0},{default:c(()=>[e("button",{type:"button",class:"input w-full flex items-center justify-between",disabled:!V.value},[e("span",Xt,o(W.value),1),i(t(H),{class:"ml-2 size-4"})],8,Kt)]),_:1}),i(t(z),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:c(()=>[i(t(q),{"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:s[2]||(s[2]=l=>Z(null))},o(t(n)("input.select_machine_group")),1)]),_:1}),(r(!0),d(h,null,y(E.value,l=>(r(),L(t(q),{key:l.production_machine_group_id,"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>Z(l.production_machine_group_id)},o(l.name)+" ("+o(l.machine_count)+" machines)",9,Qt)]),_:2},1024))),128))]),_:1})]),_:1})])])]),F.value?(r(),d("div",Wt,[e("h2",Yt,o(t(n)("input.production_output")),1),e("p",Zt,[p(o(t(n)("input.input_type"))+" ",1),e("strong",null,o(_.value?.type??"qty_only"),1)]),I.value?(r(),d("div",te,[e("div",null,[e("label",ee,[p(o(t(n)("input.normal_qty"))+" ",1),s[15]||(s[15]=e("span",{class:"text-red-500"},"*",-1))]),w(e("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>t(u).output_qty_normal=l),type:"number",min:"0",class:"input w-full",required:""},null,512),[[C,t(u).output_qty_normal,void 0,{number:!0}]]),t(u).errors.output_qty_normal?(r(),d("p",se,o(t(u).errors.output_qty_normal),1)):m("",!0)]),e("div",null,[e("label",oe,o(t(n)("input.reject_qty")),1),w(e("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>t(u).output_qty_reject=l),type:"number",min:"0",class:"input w-full"},null,512),[[C,t(u).output_qty_reject,void 0,{number:!0}]]),t(u).errors.output_qty_reject?(r(),d("p",le,o(t(u).errors.output_qty_reject),1)):m("",!0)])])):m("",!0),B.value?(r(),d("div",ue,[e("label",ne,o(t(n)("input.grades")),1),e("div",ae,[_.value?.grade_types&&_.value.grade_types.length?(r(!0),d(h,{key:0},y(_.value.grade_types,l=>(r(),d("div",{key:l},[e("label",re,o(l),1),w(e("input",{"onUpdate:modelValue":f=>t(u).output_grades[l]=f,type:"number",min:"0",class:"input w-full"},null,8,ie),[[C,t(u).output_grades[l],void 0,{number:!0}]])]))),128)):(r(!0),d(h,{key:1},y(t(u).output_grades,(l,f)=>(r(),d("div",{key:f},[e("label",de,o(f),1),w(e("input",{"onUpdate:modelValue":dt=>t(u).output_grades[f]=dt,type:"number",min:"0",class:"input w-full"},null,8,ce),[[C,t(u).output_grades[f],void 0,{number:!0}]])]))),128))])])):m("",!0),O.value?(r(),d("div",pe,[e("div",null,[e("label",me,[p(o(t(n)("input.grade"))+" ",1),s[16]||(s[16]=e("span",{class:"text-red-500"},"*",-1))]),i(t(G),null,{default:c(()=>[i(t(T),{"as-child":!0},{default:c(()=>[e("button",_e,[e("span",null,o(t(u).output_grade??t(n)("input.select_grade")),1),i(t(H),{class:"ml-2 size-4"})])]),_:1}),i(t(z),{class:"w-[var(--radix-dropdown-menu-trigger-width)]"},{default:c(()=>[i(t(q),{"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:s[5]||(s[5]=l=>t(u).output_grade=null)},o(t(n)("input.select_grade")),1)]),_:1}),_.value?.grade_types?(r(!0),d(h,{key:0},y(_.value.grade_types,l=>(r(),L(t(q),{key:l,"as-child":!0},{default:c(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>t(u).output_grade=l},o(l),9,fe)]),_:2},1024))),128)):m("",!0)]),_:1})]),_:1})])])):m("",!0),e("div",ve,[j.value.includes("ukuran")?(r(),d("div",be,[e("label",ge,o(t(n)("input.ukuran")),1),w(e("input",{"onUpdate:modelValue":s[6]||(s[6]=l=>t(u).output_ukuran=l),type:"text",class:"input w-full",placeholder:"e.g., 122x244"},null,512),[[C,t(u).output_ukuran]])])):m("",!0),e("div",null,[e("label",he,o(t(n)("input.notes")),1),w(e("textarea",{"onUpdate:modelValue":s[7]||(s[7]=l=>t(u).keterangan=l),class:"input w-full",rows:"2",placeholder:"Optional notes..."},null,512),[[C,t(u).keterangan]])])])])):m("",!0),e("div",ye,[e("button",{type:"submit",class:"hover:cursor-pointer btn",disabled:t(u).processing||!b.value},o(t(u).processing?t(n)("app.saving"):t(n)("app.save")),9,ke),e("button",{type:"button",class:"hover:cursor-pointer btn btn-ghost",onClick:s[8]||(s[8]=l=>t(et).get("/input"))},o(t(n)("app.cancel")),1)])],32)]),i(gt,{open:D.value,"onUpdate:open":s[9]||(s[9]=l=>D.value=l)},{default:c(()=>[i(ht,null,{default:c(()=>[i(yt,null,{default:c(()=>[i(kt,null,{default:c(()=>[p(o(t(n)("input.confirm_save")),1)]),_:1}),i(xt,null,{default:c(()=>[p(o(t(n)("app.are_you_sure"))+" ",1),e("strong",null,o(Q.value)+" â€¢ "+o(W.value),1),p(" "+o(t(n)("app.date").toLowerCase())+" ",1),e("strong",null,o(x.value),1),p(" "+o(t(n)("app.hour").toLowerCase())+" ",1),e("strong",null,o(X.value),1),s[17]||(s[17]=p("? ",-1))]),_:1}),e("div",xe,[e("h3",we,o(t(n)("input.preview")),1),e("div",Ce,[e("div",qe,[I.value?(r(),d("div",$e,[s[18]||(s[18]=e("span",{class:"font-medium"},"Normal:",-1)),p(" "+o(t(u).output_qty_normal??0),1)])):m("",!0),I.value?(r(),d("div",je,[s[19]||(s[19]=e("span",{class:"font-medium"},"Reject:",-1)),p(" "+o(t(u).output_qty_reject??0),1)])):m("",!0),B.value?(r(),d("div",Ne,[...s[20]||(s[20]=[e("span",{class:"font-medium"},"Grades:",-1)])])):m("",!0),B.value?(r(),d("div",Se,[_.value?.grade_types&&_.value.grade_types.length?(r(!0),d(h,{key:0},y(_.value.grade_types,l=>(r(),d("div",{key:l},[e("span",Ve,o(l)+":",1),p(" "+o(t(u).output_grades[l]??0),1)]))),128)):(r(!0),d(h,{key:1},y(t(u).output_grades,(l,f)=>(r(),d("div",{key:f},[e("span",De,o(f)+":",1),p(" "+o(l??0),1)]))),128))])):m("",!0),O.value?(r(),d("div",Ue,[s[21]||(s[21]=e("span",{class:"font-medium"},"Grade:",-1)),p(" "+o(t(u).output_grade??"-"),1)])):m("",!0),j.value.includes("ukuran")?(r(),d("div",Le,[s[22]||(s[22]=e("span",{class:"font-medium"},"Ukuran:",-1)),p(" "+o(t(u).output_ukuran??"-"),1)])):m("",!0),e("div",null,[s[23]||(s[23]=e("span",{class:"font-medium"},"Notes:",-1)),p(" "+o(t(u).keterangan??"-"),1)])])])])]),_:1}),e("div",Ge,[i(wt,null,{default:c(()=>[p(o(t(n)("app.cancel")),1)]),_:1}),i(Ct,{onClick:rt,disabled:U.value,class:"hover:cursor-pointer btn"},{default:c(()=>[p(o(U.value?t(n)("app.saving"):t(n)("app.save")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["open"]),i(qt)]),_:1},8,["breadcrumbs"])],64))}});export{Re as default};
