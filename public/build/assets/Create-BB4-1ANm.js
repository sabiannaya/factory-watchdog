import{d as k,f as z,v as C,g as _,x as E,c as O,m,u as n,p as T,w as B,a as o,t as d,y as D,B as f,F as G,o as S}from"./app-i1_2c9TI.js";import{_ as U}from"./AppLayout.vue_vue_type_script_setup_true_lang-UWREGGXY.js";import{u as $}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B0bB4Y56.js";import{_ as q,a as F}from"./MachineGroupSelector.vue_vue_type_script_setup_true_lang-BTimB4k4.js";import"./VisuallyHidden-CgfYLdxu.js";import"./index-C4J_hXM0.js";import"./x-T-BkQ4N0.js";import"./chevron-down-C8FjIUWp.js";import"./search-BWjjXBCD.js";const N={class:"p-4 space-y-4"},A={class:"text-3xl font-bold"},M={class:"text-muted-foreground dark:text-muted-foreground"},V={class:"flex items-center gap-3 pt-4"},L=["disabled"],Z=k({__name:"Create",props:{machine_groups:{}},setup(h){const{t:r}=$(),b=z(()=>[{title:r("data_management.data_management"),href:"/data-management/production"},{title:r("data_management.production"),href:"/data-management/production"},{title:r("data_management.create"),href:window.location.pathname}]),v=h,s=C({production_name:"",status:"active",target_date:null,machine_groups:{}}),i=_(null),c=_({}),l=_({});function p(t){const e={};return t&&Object.entries(t).forEach(([a,u])=>{if(a==="qty"){e.qty_normal=u;return}e[a]=u}),e}E([i,c],()=>{s.target_date=i.value,s.machine_groups=c.value},{deep:!0});function x(t){c.value=t}function y(t){i.value=t}function w(){l.value={};let t=!0;return Object.values(c.value).forEach(e=>{const a={};if((!e.machine_count||e.machine_count<1)&&(a.machine_count=["Machine count must be at least 1"],t=!1),i.value){const u=p(e.targets);Object.values(u).some(g=>g!=null)||(a.targets=["At least one target is required when target date is set"],t=!1)}Object.keys(a).length>0&&(l.value[e.machine_group_id]=a)}),t}function j(){if(!w())return;const t={};Object.entries(c.value).forEach(([e,a])=>{t[Number(e)]={...a,targets:p(a.targets),default_targets:p(a.default_targets)}}),s.machine_groups=t,s.post("/data-management/production",{preserveState:!1,onSuccess:()=>{f.get("/data-management/production")}})}return(t,e)=>(S(),O(G,null,[m(n(T),{title:n(r)("data_management.create_production")},null,8,["title"]),m(U,{breadcrumbs:b.value},{default:B(()=>[o("div",N,[o("div",null,[o("h1",A,d(n(r)("data_management.create_production")),1),o("p",M,d(n(r)("data_management.create_production_description")),1)]),o("form",{onSubmit:D(j,["prevent"]),class:"space-y-6"},[m(q,{form:n(s)},null,8,["form"]),m(F,{"machine-groups":v.machine_groups||[],"attached-groups":c.value,"target-date":i.value,errors:l.value,"onUpdate:attachedGroups":x,"onUpdate:targetDate":y},null,8,["machine-groups","attached-groups","target-date","errors"]),o("div",V,[o("button",{type:"submit",class:"hover:cursor-pointer btn",disabled:n(s).processing},d(n(s).processing?n(r)("data_management.creating"):n(r)("data_management.create_production")),9,L),o("button",{type:"button",class:"btn btn-ghost",onClick:e[0]||(e[0]=a=>n(f).get("/data-management/production"))},d(n(r)("data_management.cancel")),1)])],32)])]),_:1},8,["breadcrumbs"])],64))}});export{Z as default};
