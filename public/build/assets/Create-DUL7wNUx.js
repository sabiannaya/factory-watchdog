import{d as dt,g as b,f as _,x as R,c as i,m as a,u as s,p as ct,w as d,a as e,b as p,o as n,t as r,q as c,s as pt,y as mt,z as w,L as h,F as g,i as y,e as V,B as tt}from"./app-D4NX6RtZ.js";import{a as D,b as H,c as P,d as C,_ as ft}from"./AppLayout.vue_vue_type_script_setup_true_lang-CNNNqqjX.js";import{u as _t}from"./useHourlyInputForm-1ometYFV.js";import{_ as vt,a as bt,b as gt,c as yt,d as kt,e as xt,f as wt}from"./AlertDialogTitle.vue_vue_type_script_setup_true_lang-DhxcoGzi.js";import{_ as ht}from"./ToastNotifications.vue_vue_type_script_setup_true_lang-BMk0SZx-.js";import{u as Ct}from"./useToast-aH6RW4y0.js";import{C as U}from"./chevron-down-D-IdcPDr.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzC2dvNG.js";import"./Presence-CsGVf8pY.js";import"./createLucideIcon-A0T1vukc.js";import"./useForwardPropsEmits-BmzqlngZ.js";import"./x-XD7JAbQb.js";import"./VisuallyHidden-BeURpiPp.js";import"./index-C4J_hXM0.js";const St={class:"p-4 space-y-6"},qt={key:0,class:"rounded-lg bg-destructive/10 border border-destructive/30 p-4"},$t={class:"text-destructive font-medium"},jt={key:1,class:"rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-300 dark:border-amber-700 p-4"},Nt={class:"flex items-start gap-3"},Gt={class:"text-sm text-amber-700 dark:text-amber-300 mt-1"},It={class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},Vt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Dt={type:"button",class:"input w-full flex items-center justify-between",required:""},Ht=["onClick"],Pt={type:"button",class:"input w-full flex items-center justify-between",required:""},Ut={class:"truncate"},Et=["onClick"],Mt=["disabled"],Tt={class:"truncate"},zt=["onClick"],Ft={key:0,class:"rounded-lg border border-sidebar-border/70 bg-card p-6"},Rt={class:"text-sm text-muted-foreground mb-4"},Lt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bt={key:0,class:"text-red-500 text-sm mt-1"},At={key:0,class:"text-red-500 text-sm mt-1"},Ot={key:1,class:"space-y-4 mt-4"},Kt={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},Qt={class:"block text-sm font-medium mb-2"},Jt=["onUpdate:modelValue"],Xt={class:"block text-sm font-medium mb-2"},Wt=["onUpdate:modelValue"],Yt={key:2,class:"space-y-4 mt-4"},Zt={type:"button",class:"input w-full flex items-center justify-between",required:""},te=["onClick"],ee={class:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4"},se={key:0},le={class:"flex items-center gap-3"},oe=["disabled"],ue={class:"mt-4 border-t pt-3"},ne={class:"rounded-lg bg-muted/50 p-3"},re={class:"space-y-1 text-sm"},ae={key:0},ie={key:1},de={key:2},ce={key:3,class:"grid grid-cols-2 gap-2 mt-1"},pe={class:"font-medium"},me={class:"font-medium"},fe={key:4},_e={key:5},ve={class:"flex justify-end gap-2"},Ie=dt({__name:"Create",props:{productions:{},selectedProductionId:{},selectedDate:{},selectedHour:{}},setup(et){const st=[{title:"Input",href:"/input"},{title:"Record Input",href:window.location.pathname}],k=et,N=b(k.selectedProductionId),x=b(k.selectedDate),S=b(parseInt(String(k.selectedHour))||new Date().getHours()),v=b(null),lt=_(()=>k.productions.find(u=>u.production_id===N.value)),E=_(()=>lt.value?.machine_groups??[]),M=_(()=>E.value.find(u=>u.production_machine_group_id===v.value)),m=_(()=>M.value?.input_config),q=_(()=>M.value?.fields??[]),T=_(()=>{const u=m.value?.type??"qty_only";return u==="qty_only"||u==="normal_reject"||q.value.includes("qty_normal")||q.value.includes("qty_reject")}),z=_(()=>m.value?.type==="grades"||q.value.includes("grades")),L=_(()=>m.value?.type==="grade_qty"||q.value.includes("grade")),{form:o,setInputConfig:ot}=_t(void 0,null);o.date=x.value,o.hour=Number(S.value);const{success:ut,error:B}=Ct(),G=b(!1),I=b(!1),$=b(null),A=b(!1);let j;const F=b(!1),O=async()=>{if(!v.value||!x.value){$.value=null;return}A.value=!0;try{const t=await(await fetch("/input/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({production_machine_group_id:v.value,date:x.value,hour:S.value})})).json();$.value=t.exists?t.entry:null}catch(u){console.error("Error checking duplicate:",u)}finally{A.value=!1}};R(v,u=>{o.production_machine_group_id=u,ot(m.value),o.output_qty_normal=null,o.output_qty_reject=null,o.output_grades=o.output_grades??{},o.output_grade=null,o.output_ukuran=null,j&&clearTimeout(j),j=setTimeout(O,300)}),R([x,S],([u,t])=>{o.date=u,o.hour=Number(t),j&&clearTimeout(j),j=setTimeout(O,300)}),R($,u=>{u&&!F.value&&(B("Existing entry found",`A record already exists for this machine group at ${u.recorded_at}`),F.value=!0),u||(F.value=!1)});const K=Array.from({length:24},(u,t)=>({value:t,label:`${t.toString().padStart(2,"0")}:00`})),Q=_(()=>K.find(u=>u.value===Number(S.value))?.label??`${String(S.value).padStart(2,"0")}:00`),J=_(()=>k.productions.find(u=>u.production_id===N.value)?.production_name??"Select Production"),X=_(()=>E.value.find(u=>u.production_machine_group_id===v.value)?.name??"Select Machine Group"),nt=u=>{S.value=Number(u),o.hour=Number(u)},W=u=>{if(N.value=u,v.value=null,u!==null){const t=k.productions.find(l=>l.production_id===u);t&&t.machine_groups&&t.machine_groups.length>0&&(v.value=t.machine_groups[0].production_machine_group_id)}},Y=u=>{v.value=u},rt=()=>{I.value=!0,o.post("/input",{onSuccess:()=>{ut("Input saved","Hourly input has been recorded"),tt.get("/input",{date:o.date,production_id:N.value})},onError:()=>{B("Failed to save","There was an error saving the input")},onFinish:()=>{I.value=!1,G.value=!1}})},at=()=>{G.value=!0},Z=_(()=>!!o.errors.duplicate);return(u,t)=>(n(),i(g,null,[a(s(ct),{title:"Record Hourly Input"}),a(ft,{breadcrumbs:st},{default:d(()=>[e("div",St,[t[27]||(t[27]=e("div",null,[e("h1",{class:"text-2xl font-bold"},"Record Hourly Input"),e("p",{class:"text-muted-foreground"},"Record production output for a specific hour")],-1)),Z.value?(n(),i("div",qt,[e("p",$t,r(s(o).errors.duplicate),1)])):p("",!0),$.value&&!Z.value?(n(),i("div",jt,[e("div",Nt,[t[13]||(t[13]=e("svg",{class:"size-5 text-amber-600 dark:text-amber-400 mt-0.5 shrink-0",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("div",null,[t[12]||(t[12]=e("p",{class:"font-medium text-amber-800 dark:text-amber-200"},"Existing Entry Found",-1)),e("p",Gt,[c(" A record already exists for this machine group at "+r($.value.recorded_at)+". ",1),a(s(pt),{href:`/input/${$.value.hourly_log_id}/edit`,class:"underline font-medium"},{default:d(()=>[...t[10]||(t[10]=[c(" Edit existing entry ",-1)])]),_:1},8,["href"]),t[11]||(t[11]=c(" instead? ",-1))])])])])):p("",!0),e("form",{onSubmit:mt(at,["prevent"]),class:"space-y-6"},[e("div",It,[t[18]||(t[18]=e("h2",{class:"text-lg font-semibold mb-4"},"Select Production & Time",-1)),e("div",Vt,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium mb-2"},[c("Date "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>x.value=l),type:"date",class:"input w-full",required:""},null,512),[[h,x.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium mb-2"},[c("Hour "),e("span",{class:"text-red-500"},"*")],-1)),a(s(D),null,{default:d(()=>[a(s(H),{"as-child":!0},{default:d(()=>[e("button",Dt,[e("span",null,r(Q.value),1),a(s(U),{class:"ml-2 size-4"})])]),_:1}),a(s(P),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:d(()=>[(n(!0),i(g,null,y(s(K),l=>(n(),V(s(C),{"as-child":!0,key:l.value},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>nt(l.value)},r(l.label),9,Ht)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium mb-2"},[c("Production "),e("span",{class:"text-red-500"},"*")],-1)),a(s(D),null,{default:d(()=>[a(s(H),{"as-child":!0},{default:d(()=>[e("button",Pt,[e("span",Ut,r(J.value),1),a(s(U),{class:"ml-2 size-4"})])]),_:1}),a(s(P),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:d(()=>[a(s(C),{"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:t[1]||(t[1]=l=>W(null))},"Select Production")]),_:1}),(n(!0),i(g,null,y(k.productions,l=>(n(),V(s(C),{key:l.production_id,"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>W(l.production_id)},r(l.production_name),9,Et)]),_:2},1024))),128))]),_:1})]),_:1})]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium mb-2"},[c("Machine Group "),e("span",{class:"text-red-500"},"*")],-1)),a(s(D),null,{default:d(()=>[a(s(H),{"as-child":!0},{default:d(()=>[e("button",{type:"button",class:"input w-full flex items-center justify-between",disabled:!N.value},[e("span",Tt,r(X.value),1),a(s(U),{class:"ml-2 size-4"})],8,Mt)]),_:1}),a(s(P),{class:"w-[var(--reka-dropdown-menu-trigger-width)] max-w-none"},{default:d(()=>[a(s(C),{"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:t[2]||(t[2]=l=>Y(null))},"Select Machine Group")]),_:1}),(n(!0),i(g,null,y(E.value,l=>(n(),V(s(C),{key:l.production_machine_group_id,"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>Y(l.production_machine_group_id)},r(l.name)+" ("+r(l.machine_count)+" machines)",9,zt)]),_:2},1024))),128))]),_:1})]),_:1})])])]),M.value?(n(),i("div",Ft,[t[26]||(t[26]=e("h2",{class:"text-lg font-semibold mb-4"},"Production Output",-1)),e("p",Rt,[t[19]||(t[19]=c(" Input type: ",-1)),e("strong",null,r(m.value?.type??"qty_only"),1)]),T.value?(n(),i("div",Lt,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium mb-2"},[c("Normal Quantity "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s(o).output_qty_normal=l),type:"number",min:"0",class:"input w-full",required:""},null,512),[[h,s(o).output_qty_normal,void 0,{number:!0}]]),s(o).errors.output_qty_normal?(n(),i("p",Bt,r(s(o).errors.output_qty_normal),1)):p("",!0)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium mb-2"},"Reject Quantity",-1)),w(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s(o).output_qty_reject=l),type:"number",min:"0",class:"input w-full"},null,512),[[h,s(o).output_qty_reject,void 0,{number:!0}]]),s(o).errors.output_qty_reject?(n(),i("p",At,r(s(o).errors.output_qty_reject),1)):p("",!0)])])):p("",!0),z.value?(n(),i("div",Ot,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium mb-2"},"Grades (Multiple)",-1)),e("div",Kt,[m.value?.grade_types&&m.value.grade_types.length?(n(!0),i(g,{key:0},y(m.value.grade_types,l=>(n(),i("div",{key:l},[e("label",Qt,r(l),1),w(e("input",{"onUpdate:modelValue":f=>s(o).output_grades[l]=f,type:"number",min:"0",class:"input w-full"},null,8,Jt),[[h,s(o).output_grades[l],void 0,{number:!0}]])]))),128)):(n(!0),i(g,{key:1},y(s(o).output_grades,(l,f)=>(n(),i("div",{key:f},[e("label",Xt,r(f),1),w(e("input",{"onUpdate:modelValue":it=>s(o).output_grades[f]=it,type:"number",min:"0",class:"input w-full"},null,8,Wt),[[h,s(o).output_grades[f],void 0,{number:!0}]])]))),128))])])):p("",!0),L.value?(n(),i("div",Yt,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium mb-2"},[c("Grade (Single) "),e("span",{class:"text-red-500"},"*")],-1)),a(s(D),null,{default:d(()=>[a(s(H),{"as-child":!0},{default:d(()=>[e("button",Zt,[e("span",null,r(s(o).output_grade??"Select Grade"),1),a(s(U),{class:"ml-2 size-4"})])]),_:1}),a(s(P),{class:"w-[var(--radix-dropdown-menu-trigger-width)]"},{default:d(()=>[a(s(C),{"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:t[5]||(t[5]=l=>s(o).output_grade=null)},"Select Grade")]),_:1}),m.value?.grade_types?(n(!0),i(g,{key:0},y(m.value.grade_types,l=>(n(),V(s(C),{key:l,"as-child":!0},{default:d(()=>[e("button",{class:"block w-full text-left px-3 py-2 text-sm",onClick:f=>s(o).output_grade=l},r(l),9,te)]),_:2},1024))),128)):p("",!0)]),_:1})]),_:1})])])):p("",!0),e("div",ee,[q.value.includes("ukuran")?(n(),i("div",se,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium mb-2"},"Ukuran (Size)",-1)),w(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>s(o).output_ukuran=l),type:"text",class:"input w-full",placeholder:"e.g., 122x244"},null,512),[[h,s(o).output_ukuran]])])):p("",!0),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium mb-2"},"Notes (Keterangan)",-1)),w(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=l=>s(o).keterangan=l),class:"input w-full",rows:"2",placeholder:"Optional notes..."},null,512),[[h,s(o).keterangan]])])])])):p("",!0),e("div",le,[e("button",{type:"submit",class:"hover:cursor-pointer btn",disabled:s(o).processing||!v.value},r(s(o).processing?"Saving...":"Save Input"),9,oe),e("button",{type:"button",class:"hover:cursor-pointer btn btn-ghost",onClick:t[8]||(t[8]=l=>s(tt).get("/input"))}," Cancel ")])],32)]),a(vt,{open:G.value,"onUpdate:open":t[9]||(t[9]=l=>G.value=l)},{default:d(()=>[a(bt,null,{default:d(()=>[a(gt,null,{default:d(()=>[a(yt,null,{default:d(()=>[...t[28]||(t[28]=[c("Confirm Save Hourly Input",-1)])]),_:1}),a(kt,null,{default:d(()=>[t[29]||(t[29]=c(" Are you sure you want to record the hourly input for ",-1)),e("strong",null,r(J.value)+" â€¢ "+r(X.value),1),t[30]||(t[30]=c(" on ",-1)),e("strong",null,r(x.value),1),t[31]||(t[31]=c(" at ",-1)),e("strong",null,r(Q.value),1),t[32]||(t[32]=c("? ",-1))]),_:1}),e("div",ue,[t[39]||(t[39]=e("h3",{class:"text-sm font-medium mb-2"},"Preview",-1)),e("div",ne,[e("div",re,[T.value?(n(),i("div",ae,[t[33]||(t[33]=e("span",{class:"font-medium"},"Normal:",-1)),c(" "+r(s(o).output_qty_normal??0),1)])):p("",!0),T.value?(n(),i("div",ie,[t[34]||(t[34]=e("span",{class:"font-medium"},"Reject:",-1)),c(" "+r(s(o).output_qty_reject??0),1)])):p("",!0),z.value?(n(),i("div",de,[...t[35]||(t[35]=[e("span",{class:"font-medium"},"Grades:",-1)])])):p("",!0),z.value?(n(),i("div",ce,[m.value?.grade_types&&m.value.grade_types.length?(n(!0),i(g,{key:0},y(m.value.grade_types,l=>(n(),i("div",{key:l},[e("span",pe,r(l)+":",1),c(" "+r(s(o).output_grades[l]??0),1)]))),128)):(n(!0),i(g,{key:1},y(s(o).output_grades,(l,f)=>(n(),i("div",{key:f},[e("span",me,r(f)+":",1),c(" "+r(l??0),1)]))),128))])):p("",!0),L.value?(n(),i("div",fe,[t[36]||(t[36]=e("span",{class:"font-medium"},"Grade:",-1)),c(" "+r(s(o).output_grade??"-"),1)])):p("",!0),q.value.includes("ukuran")?(n(),i("div",_e,[t[37]||(t[37]=e("span",{class:"font-medium"},"Ukuran:",-1)),c(" "+r(s(o).output_ukuran??"-"),1)])):p("",!0),e("div",null,[t[38]||(t[38]=e("span",{class:"font-medium"},"Notes:",-1)),c(" "+r(s(o).keterangan??"-"),1)])])])])]),_:1}),e("div",ve,[a(xt,null,{default:d(()=>[...t[40]||(t[40]=[c("Cancel",-1)])]),_:1}),a(wt,{onClick:rt,disabled:I.value,class:"hover:cursor-pointer btn"},{default:d(()=>[c(r(I.value?"Saving...":"Save Input"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["open"]),a(ht)]),_:1})],64))}});export{Ie as default};
